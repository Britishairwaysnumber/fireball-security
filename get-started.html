<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Started | Fireball Cyber Labs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=AaRVS6xnpA6IVlDhvQLautUIeNhzycMVkwJkhmzFB8BgCtOyFRiutSwGi648-WtE-h04fJs70CUfTaNH"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .selected-card { border-color: #10b981; background-color: #f0fdf4; ring-2 ring-green-500; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #16a34a; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden-force { display: none !important; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen flex flex-col">

    <nav class="bg-white border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-6 h-20 flex justify-between items-center">
            <a href="index.html" class="font-bold text-xl tracking-tight text-gray-900">Fireball Cyber Labs</a>
            <a href="index.html" class="text-sm font-bold text-gray-600 hover:text-green-600">Back to Home</a>
        </div>
    </nav>

    <main class="flex-grow py-12 px-6">
        <div class="max-w-5xl mx-auto">
            
            <div id="step-1" class="grid lg:grid-cols-2 gap-12 items-start">
                
                <div>
                    <h1 class="text-3xl font-extrabold mb-2">Configure License</h1>
                    <p class="text-gray-500 mb-8">Secure your devices with military-grade protection.</p>

                    <form onsubmit="goToPayment(event)" class="space-y-5 bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Full Name</label>
                            <input type="text" id="name" required class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none" placeholder="John Doe">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Email Address</label>
                            <input type="email" id="email" required class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none" placeholder="john@example.com">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Phone Number</label>
                            <input type="tel" id="phone" required class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none" placeholder="+1 555 000 0000">
                        </div>
                        
                        <div class="pt-4 border-t border-gray-100">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-gray-500">Selected Plan:</span>
                                <span id="summary-plan" class="font-bold text-gray-900">Personal (1 Device)</span>
                            </div>
                            <div class="flex justify-between items-center mb-6">
                                <span class="text-gray-500">Total Price:</span>
                                <span id="summary-price" class="text-2xl font-extrabold text-green-600">$39.00</span>
                            </div>
                            <button type="submit" class="w-full bg-black hover:bg-gray-800 text-white font-bold py-4 rounded-xl transition shadow-lg flex justify-center items-center">
                                Proceed to Checkout
                            </button>
                            <p class="text-xs text-center text-gray-400 mt-4 flex justify-center items-center">
                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                                256-bit Secure SSL Payment
                            </p>
                        </div>
                    </form>
                </div>

                <div class="space-y-4">
                    <p class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-2">Select Device Count</p>
                    
                    <div onclick="selectPlan(1, 39, 'Personal License')" id="card-1" class="cursor-pointer border-2 border-gray-200 bg-white p-6 rounded-xl hover:border-green-400 transition flex justify-between items-center selected-card">
                        <div>
                            <h3 class="font-bold text-gray-900">Personal License</h3>
                            <p class="text-sm text-gray-500">1 Device • $39/device</p>
                        </div>
                        <div class="text-xl font-bold">$39</div>
                    </div>

                    <div onclick="selectPlan(3, 79, 'Household License')" id="card-3" class="cursor-pointer border-2 border-gray-200 bg-white p-6 rounded-xl hover:border-green-400 transition flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-gray-900">Household License</h3>
                            <p class="text-sm text-gray-500">3 Devices • <span class="text-green-600 font-bold">$26/device</span></p>
                        </div>
                        <div class="text-xl font-bold">$79</div>
                    </div>

                    <div onclick="selectPlan(5, 129, 'Office License')" id="card-5" class="cursor-pointer border-2 border-gray-200 bg-white p-6 rounded-xl hover:border-green-400 transition flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-gray-900">Office License</h3>
                            <p class="text-sm text-gray-500">5 Devices • <span class="text-green-600 font-bold">$25/device</span></p>
                        </div>
                        <div class="text-xl font-bold">$129</div>
                    </div>

                    <div onclick="selectPlan(10, 249, 'Enterprise License')" id="card-10" class="cursor-pointer border-2 border-gray-200 bg-white p-6 rounded-xl hover:border-green-400 transition flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-gray-900">Enterprise License</h3>
                            <p class="text-sm text-gray-500">10 Devices • <span class="text-green-600 font-bold">$24/device</span></p>
                        </div>
                        <div class="text-xl font-bold">$249</div>
                    </div>
                </div>
            </div>

            <div id="step-2" class="hidden-force max-w-md mx-auto bg-white p-10 rounded-2xl shadow-xl border border-gray-100">
                <div class="text-center mb-6">
                    <h1 class="text-2xl font-bold mb-2">Secure Checkout</h1>
                    <p class="text-gray-500">Total Due: <span id="pay-amount" class="text-gray-900 font-bold text-xl">$39.00</span></p>
                </div>
                
                <div id="paypal-button-container" class="space-y-4"></div>
                
                <button onclick="goBack()" class="mt-6 text-sm text-gray-400 hover:text-gray-600 underline w-full text-center">Change Plan</button>
            </div>

            <div id="step-loading" class="hidden-force text-center py-20">
                <div class="loader mx-auto mb-6"></div>
                <h2 class="text-2xl font-bold mb-2">Activating License...</h2>
                <p class="text-gray-500">Configuring your premium security suite.</p>
            </div>

            <div id="step-success" class="hidden-force max-w-md mx-auto text-center bg-white p-10 rounded-2xl shadow-xl border border-gray-100">
                <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6 text-2xl">✓</div>
                <h2 class="text-2xl font-bold mb-2">Order Complete!</h2>
                <p class="text-gray-500 mb-6">Your license has been sent to your email.</p>

                <div class="bg-gray-50 border border-gray-200 rounded-xl p-4 mb-6 text-left">
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">LICENSE KEY</p>
                    <p id="display-key" class="font-mono text-xl font-bold text-gray-900 tracking-wide select-all">LOADING...</p>
                    <div class="flex justify-between mt-3 pt-3 border-t border-gray-200 text-xs text-gray-500">
                        <span>Plan: <b id="final-plan">Pro</b></span>
                        <span>Limit: <b id="final-limit">1 Device</b></span>
                    </div>
                </div>

                <a href="Fireball_Installer_v1.0.exe" class="block w-full bg-black hover:bg-gray-800 text-white font-bold py-3 rounded-lg transition shadow-lg mb-4">
                    Download Installer
                </a>
            </div>

        </div>
    </main>

    <footer class="text-center py-6 text-gray-400 text-xs">
        &copy; 2026 Fireball Cyber Labs. Secured by PayPal.
    </footer>

    <script>
        // CONFIGURATION
        const { createClient } = supabase;
        const SUPABASE_URL = 'https://khsjdvowognsytjdwdup.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtoc2pkdm93b2duc3l0amR3ZHVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwOTEzMzMsImV4cCI6MjA4MjY2NzMzM30.DJs58NacEEdFbeKO4sE-0jayBZU5pO0ozUD3rj1sOFA';
        const db = createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // Current Selection State
        let selectedDevices = 1;
        let selectedPrice = 39;
        let selectedName = "Personal License";

        function selectPlan(devices, price, name) {
            // Update State
            selectedDevices = devices;
            selectedPrice = price;
            selectedName = name;

            // Update Visuals
            document.querySelectorAll('[id^="card-"]').forEach(el => {
                el.classList.remove('selected-card'); 
            });
            document.getElementById('card-' + devices).classList.add('selected-card'); 

            // Update Text Summary
            document.getElementById('summary-plan').innerText = name + ` (${devices} Device${devices > 1 ? 's' : ''})`;
            document.getElementById('summary-price').innerText = "$" + price + ".00";
        }

        function goToPayment(e) {
            e.preventDefault();
            
            // Save User Data
            const user = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                plan: selectedName,
                devices: selectedDevices,
                amount: selectedPrice + ".00"
            };
            localStorage.setItem('fireball_user', JSON.stringify(user));

            // Show Payment Screen
            document.getElementById('pay-amount').innerText = "$" + user.amount;
            document.getElementById('step-1').classList.add('hidden-force');
            document.getElementById('step-2').classList.remove('hidden-force');
        }

        function goBack() {
            document.getElementById('step-2').classList.add('hidden-force');
            document.getElementById('step-1').classList.remove('hidden-force');
        }

        // --- LICENSE GENERATION LOGIC ---
        async function processLicenseGeneration(forcedData = null) {
            let user = forcedData;
            if(!user) {
                const stored = localStorage.getItem('fireball_user');
                if(stored) user = JSON.parse(stored);
            }
            if(!user) return alert("Error: User data missing.");

            document.getElementById('step-1').classList.add('hidden-force');
            document.getElementById('step-2').classList.add('hidden-force');
            document.getElementById('step-loading').classList.remove('hidden-force');

            const expiry = new Date();
            expiry.setFullYear(expiry.getFullYear() + 1);

            try {
                const { data, error } = await db
                    .from('licenses')
                    .insert([{ 
                        owner_name: user.name, 
                        owner_email: user.email, 
                        phone: user.phone,      
                        plan_type: user.plan,   
                        is_active: true,
                        expires_at: expiry,
                        max_devices: user.devices 
                    }])
                    .select();

                if (error) throw error;

                if(data && data.length > 0) {
                    const lic = data[0];
                    document.getElementById('step-loading').classList.add('hidden-force');
                    document.getElementById('step-success').classList.remove('hidden-force');
                    document.getElementById('display-key').innerText = lic.license_key;
                    document.getElementById('final-plan').innerText = user.plan;
                    document.getElementById('final-limit').innerText = user.devices + " Device(s)";
                }
            } catch (err) {
                alert("Database Error: " + err.message);
                goBack();
            }
        }

        // PAYPAL BUTTON RENDER
        paypal.Buttons({
            createOrder: function(data, actions) {
                const saved = JSON.parse(localStorage.getItem('fireball_user'));
                return actions.order.create({
                    purchase_units: [{ amount: { value: saved.amount } }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    processLicenseGeneration();
                });
            }
        }).render('#paypal-button-container');

    </script>
</body>
</html>